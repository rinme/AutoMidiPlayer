<Application
    x:Class="AutoMidiPlayer.WPF.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:s="https://github.com/canton7/Stylet"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:modern="http://schemas.modernwpf.com/2019"
    xmlns:wpf="clr-namespace:AutoMidiPlayer.WPF">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>

                <s:ApplicationLoader>
                    <s:ApplicationLoader.Bootstrapper>
                        <wpf:Bootstrapper/>
                    </s:ApplicationLoader.Bootstrapper>
                </s:ApplicationLoader>

                <modern:ThemeResources/>
                <modern:XamlControlsResources/>
                <modern:IntellisenseResources Source="/ModernWpf;component/DesignTime/DesignTimeResources.xaml"/>

                <ui:ThemesDictionary Theme="Dark"/>
                <ui:ControlsDictionary/>

                <!-- Custom Icon Resources -->
                <ResourceDictionary Source="/Resources/Icons.xaml"/>

            </ResourceDictionary.MergedDictionaries>

            <Style TargetType="modern:SimpleStackPanel">
                <Setter Property="Spacing"
                        Value="10"/>
                <Style.Resources>
                    <Style TargetType="ComboBox"
                           BasedOn="{StaticResource {x:Type ComboBox}}">
                        <Setter Property="MinWidth"
                                Value="200"/>
                    </Style>
                    <Style TargetType="TextBox"
                           BasedOn="{StaticResource {x:Type TextBox}}">
                        <Setter Property="MinWidth"
                                Value="200"/>
                    </Style>
                    <Style TargetType="Button"
                           BasedOn="{StaticResource {x:Type Button}}">
                        <Setter Property="Background"
                                Value="Transparent"/>
                        <Style.Triggers>
                            <Trigger Property="IsHitTestVisible"
                                     Value="False">
                                <Setter Property="Foreground"
                                        Value="Gray"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Style.Resources>
            </Style>

            <Style TargetType="modern:NumberBox">
                <Setter Property="Minimum"
                        Value="0"/>
                <Setter Property="SpinButtonPlacementMode"
                        Value="Compact"/>
            </Style>

            <!-- Shared FontIcon style for MDL2 Assets icons -->
            <Style x:Key="MdlFontIcon"
                   TargetType="ui:FontIcon">
                <Setter Property="FontFamily"
                        Value="Segoe MDL2 Assets"/>
                <Setter Property="FontSize"
                        Value="14"/>
            </Style>

            <!-- FontFamily resource for direct use -->
            <FontFamily x:Key="MdlFontFamily">Segoe MDL2 Assets</FontFamily>

            <!-- Player control button style with clean hover (no background, icon turns white) -->
            <Style x:Key="PlayerControlButton"
                   TargetType="Button">
                <Setter Property="Background"
                        Value="Transparent"/>
                <Setter Property="BorderThickness"
                        Value="0"/>
                <Setter Property="Padding"
                        Value="8"/>
                <Setter Property="Cursor"
                        Value="Hand"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="Transparent"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsHitTestVisible"
                             Value="False">
                        <Setter Property="Opacity"
                                Value="0.4"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Path style for scaling icons inside buttons with smooth transitions -->
            <Style x:Key="PlayerControlIcon"
                   TargetType="Path">
                <Setter Property="Stretch"
                        Value="Uniform"/>
                <Setter Property="RenderTransformOrigin"
                        Value="0.5,0.5"/>
                <Setter Property="RenderTransform">
                    <Setter.Value>
                        <ScaleTransform x:Name="IconScale"
                                        ScaleX="1"
                                        ScaleY="1"/>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}"
                                 Value="True">
                        <DataTrigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleX)"
                                                     To="1.04"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleY)"
                                                     To="1.04"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleX)"
                                                     To="1"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleY)"
                                                     To="1"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.ExitActions>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsPressed, RelativeSource={RelativeSource AncestorType=Button}}"
                                 Value="True">
                        <DataTrigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleX)"
                                                     To="1"
                                                     Duration="0:0:0.05">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleY)"
                                                     To="1"
                                                     Duration="0:0:0.05">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- Path style for prev/next icons with lighter hover color -->
            <Style x:Key="PlayerControlIconNav"
                   TargetType="Path">
                <Setter Property="Stretch"
                        Value="Uniform"/>
                <Setter Property="Fill"
                        Value="{DynamicResource TextFillColorTertiaryBrush}"/>
                <Setter Property="RenderTransformOrigin"
                        Value="0.5,0.5"/>
                <Setter Property="RenderTransform">
                    <Setter.Value>
                        <ScaleTransform ScaleX="1"
                                        ScaleY="1"/>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}"
                                 Value="True">
                        <Setter Property="Fill"
                                Value="White"/>
                        <DataTrigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleX)"
                                                     To="1.04"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleY)"
                                                     To="1.04"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                        <DataTrigger.ExitActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleX)"
                                                     To="1"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleY)"
                                                     To="1"
                                                     Duration="0:0:0.12">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <ColorAnimation Storyboard.TargetProperty="(Path.Fill).(SolidColorBrush.Color)"
                                                    Duration="0:0:0.12">
                                        <ColorAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </ColorAnimation.EasingFunction>
                                    </ColorAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.ExitActions>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding IsPressed, RelativeSource={RelativeSource AncestorType=Button}}"
                                 Value="True">
                        <DataTrigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleX)"
                                                     To="1"
                                                     Duration="0:0:0.05">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="(Path.RenderTransform).(ScaleTransform.ScaleY)"
                                                     To="1"
                                                     Duration="0:0:0.05">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </DataTrigger.EnterActions>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <!-- Play button (circle with inverted colors) -->
            <Style x:Key="PlayPauseButton"
                   TargetType="Button"
                   BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="Width"
                        Value="32"/>
                <Setter Property="Height"
                        Value="32"/>
                <Setter Property="Padding"
                        Value="0"/>
                <Setter Property="Background"
                        Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                <Setter Property="Foreground"
                        Value="{DynamicResource SystemControlBackgroundAltHighBrush}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid x:Name="RootGrid"
                                  RenderTransformOrigin="0.5,0.5">
                                <Grid.RenderTransform>
                                    <ScaleTransform ScaleX="1"
                                                    ScaleY="1"/>
                                </Grid.RenderTransform>
                                <Ellipse Fill="{TemplateBinding Background}"/>
                                <ContentPresenter HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver"
                                         Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="RootGrid"
                                                                 Storyboard.TargetProperty="(Grid.RenderTransform).(ScaleTransform.ScaleX)"
                                                                 To="1.04"
                                                                 Duration="0:0:0.12">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="RootGrid"
                                                                 Storyboard.TargetProperty="(Grid.RenderTransform).(ScaleTransform.ScaleY)"
                                                                 To="1.04"
                                                                 Duration="0:0:0.12">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="RootGrid"
                                                                 Storyboard.TargetProperty="(Grid.RenderTransform).(ScaleTransform.ScaleX)"
                                                                 To="1"
                                                                 Duration="0:0:0.12">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="RootGrid"
                                                                 Storyboard.TargetProperty="(Grid.RenderTransform).(ScaleTransform.ScaleY)"
                                                                 To="1"
                                                                 Duration="0:0:0.12">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                                <Trigger Property="IsPressed"
                                         Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="RootGrid"
                                                                 Storyboard.TargetProperty="(Grid.RenderTransform).(ScaleTransform.ScaleX)"
                                                                 To="1"
                                                                 Duration="0:0:0.05">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="RootGrid"
                                                                 Storyboard.TargetProperty="(Grid.RenderTransform).(ScaleTransform.ScaleY)"
                                                                 To="1"
                                                                 Duration="0:0:0.05">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Filled part of slider track (left of thumb) -->
            <Style x:Key="SliderRepeatButtonFilled"
                   TargetType="RepeatButton">
                <Setter Property="OverridesDefaultStyle"
                        Value="True"/>
                <Setter Property="Focusable"
                        Value="False"/>
                <Setter Property="IsTabStop"
                        Value="False"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="RepeatButton">
                            <Border x:Name="FilledBorder"
                                    Height="4"
                                    Background="White"
                                    CornerRadius="2"/>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Unfilled part of slider track (right of thumb) -->
            <Style x:Key="SliderRepeatButtonEmpty"
                   TargetType="RepeatButton">
                <Setter Property="OverridesDefaultStyle"
                        Value="True"/>
                <Setter Property="Focusable"
                        Value="False"/>
                <Setter Property="IsTabStop"
                        Value="False"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="RepeatButton">
                            <Border Height="4"
                                    Background="#4DFFFFFF"
                                    CornerRadius="0,2,2,0"/>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Progress slider style with filled track and animated thumb -->
            <Style x:Key="ProgressSlider"
                   TargetType="Slider">
                <Setter Property="Stylus.IsPressAndHoldEnabled"
                        Value="False"/>
                <Setter Property="Background"
                        Value="Transparent"/>
                <Setter Property="IsMoveToPointEnabled"
                        Value="True"/>
                <Setter Property="Margin"
                        Value="8,0"/>
                <Setter Property="MinHeight"
                        Value="20"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Slider">
                            <Grid x:Name="SliderContainer">
                                <!-- Invisible hit area to prevent flickering at edges -->
                                <Border Background="Transparent"
                                        Height="20"
                                        VerticalAlignment="Center"/>
                                <Track x:Name="PART_Track"
                                       Margin="6,0">
                                    <Track.DecreaseRepeatButton>
                                        <RepeatButton x:Name="FilledTrack"
                                                      Command="{x:Static Slider.DecreaseLarge}"
                                                      Style="{StaticResource SliderRepeatButtonFilled}"/>
                                    </Track.DecreaseRepeatButton>
                                    <Track.IncreaseRepeatButton>
                                        <RepeatButton x:Name="EmptyTrack"
                                                      Command="{x:Static Slider.IncreaseLarge}"
                                                      Style="{StaticResource SliderRepeatButtonEmpty}"/>
                                    </Track.IncreaseRepeatButton>
                                    <Track.Thumb>
                                        <Thumb x:Name="SliderThumb"
                                               Width="12"
                                               Height="12"
                                               Margin="-15,0,-15,0"
                                               VerticalAlignment="Center"
                                               Focusable="False"
                                               OverridesDefaultStyle="True"
                                               RenderTransformOrigin="0.5,0.5"
                                               Opacity="0">
                                            <Thumb.RenderTransform>
                                                <ScaleTransform ScaleX="0"
                                                        ScaleY="0"/>
                                            </Thumb.RenderTransform>
                                            <Thumb.Template>
                                                <ControlTemplate TargetType="Thumb">
                                                    <Grid Background="Transparent">
                                                        <Ellipse Width="12"
                                                                 Height="12"
                                                                 Fill="White"/>
                                                    </Grid>
                                                </ControlTemplate>
                                            </Thumb.Template>
                                        </Thumb>
                                    </Track.Thumb>
                                </Track>
                            </Grid>

                            <ControlTemplate.Triggers>
                                <!-- Hover: animate thumb appearance and change track to accent -->
                                <Trigger Property="IsMouseOver"
                                         Value="True">
                                    <Setter TargetName="FilledTrack"
                                            Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Height="4"
                                                        Background="{DynamicResource SystemAccentColorBrush}"
                                                        CornerRadius="2"/>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="SliderThumb"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="1"
                                                        Duration="0:0:0.15"/>
                                                <DoubleAnimation Storyboard.TargetName="SliderThumb"
                                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                                 To="1"
                                                        Duration="0:0:0.15"/>
                                                <DoubleAnimation Storyboard.TargetName="SliderThumb"
                                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                                 To="1"
                                                        Duration="0:0:0.15"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="SliderThumb"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="0"
                                                        Duration="0:0:0.15"/>
                                                <DoubleAnimation Storyboard.TargetName="SliderThumb"
                                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                                 To="0"
                                                        Duration="0:0:0.15"/>
                                                <DoubleAnimation Storyboard.TargetName="SliderThumb"
                                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                                 To="0"
                                                        Duration="0:0:0.15"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                                <!-- Disabled state -->
                                <Trigger Property="IsEnabled"
                                         Value="False">
                                    <Setter TargetName="FilledTrack"
                                            Property="Opacity"
                                            Value="0.3"/>
                                    <Setter TargetName="EmptyTrack"
                                            Property="Opacity"
                                            Value="0.3"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Application.Resources>
</Application>
