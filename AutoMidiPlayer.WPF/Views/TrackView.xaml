<UserControl
	x:Class="AutoMidiPlayer.WPF.Views.TrackView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	mc:Ignorable="d"
	xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
	xmlns:modern="http://schemas.modernwpf.com/2019"
	xmlns:s="https://github.com/canton7/Stylet"
	xmlns:viewModels="clr-namespace:AutoMidiPlayer.WPF.ViewModels"
	d:DataContext="{d:DesignInstance Type=viewModels:TrackViewModel}">
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Header -->
		<TextBlock Grid.Row="0"
				   VerticalAlignment="Center"
				   FontSize="16"
				   Margin="0,0,0,4"
				   Text="{Binding Queue.OpenedFile.Title, Mode=OneWay, FallbackValue=Select a song from Songs or Queue}"/>

		<!-- Notes Statistics -->
		<TextBlock Grid.Row="1"
				   VerticalAlignment="Center"
				   FontSize="12"
				   Opacity="0.7"
				   Margin="0,0,0,10"
				   Text="{Binding NotesStatsDisplay}"
				   Visibility="{Binding Queue.OpenedFile, Converter={x:Static s:BoolToVisibilityConverter.Instance}}"/>

		<!-- Track Cards -->
		<ScrollViewer Grid.Row="2">
			<ItemsControl ItemsSource="{Binding MidiTracks}">
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<Grid Margin="0,4">
							<!-- Glow layer (behind content) -->
							<Border x:Name="GlowBorder"
									Margin="0"
									BorderThickness="2"
									CornerRadius="6"
									BorderBrush="#1DB954"
									Opacity="0"
									IsHitTestVisible="False">
								<Border.Effect>
									<DropShadowEffect
										Color="#1DB954"
										BlurRadius="25"
										ShadowDepth="0"
										Opacity="1"/>
								</Border.Effect>
								<Border.Style>
									<Style TargetType="Border">
										<Style.Triggers>
											<DataTrigger Binding="{Binding IsActive}"
														 Value="True">
												<DataTrigger.EnterActions>
													<BeginStoryboard>
														<Storyboard>
															<DoubleAnimation
																Storyboard.TargetProperty="Opacity"
																To="1"
																Duration="0:0:0.05"/>
														</Storyboard>
													</BeginStoryboard>
												</DataTrigger.EnterActions>
												<DataTrigger.ExitActions>
													<BeginStoryboard>
														<Storyboard>
															<DoubleAnimation
																Storyboard.TargetProperty="Opacity"
																To="0"
																Duration="0:0:0.2"/>
														</Storyboard>
													</BeginStoryboard>
												</DataTrigger.ExitActions>
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</Border.Style>
							</Border>

							<!-- Content layer -->
							<Border x:Name="TrackBorder"
									Padding="12,8"
									BorderThickness="2"
									CornerRadius="6"
									BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
									Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="*"/>
									</Grid.ColumnDefinitions>

									<!-- Toggle and Track Name -->
									<modern:ToggleSwitch Grid.Column="0"
														 IsOn="{Binding IsChecked}"
														 IsEnabled="{Binding CanBePlayed}"
														 OffContent="{Binding TrackName, TargetNullValue=Unknown}"
														 OnContent="{Binding TrackName, TargetNullValue=Unknown}"
														 MinWidth="180">
										<modern:ToggleSwitch.Style>
											<Style TargetType="modern:ToggleSwitch">
												<Style.Triggers>
													<Trigger Property="IsEnabled"
															 Value="False">
														<Setter Property="ToolTip"
																Value="Cannot disable track containing tempo settings."/>
														<Setter Property="ToolTipService.ShowOnDisabled"
																Value="True"/>
													</Trigger>
												</Style.Triggers>
											</Style>
										</modern:ToggleSwitch.Style>
									</modern:ToggleSwitch>

									<!-- Statistics -->
									<modern:SimpleStackPanel Grid.Column="1"
															 Orientation="Horizontal"
															 HorizontalAlignment="Right"
															 Spacing="16">
										<StackPanel ToolTip="Total number of notes">
											<TextBlock Text="Notes"
													   FontSize="10"
													   Opacity="0.6"
													   HorizontalAlignment="Center"/>
											<TextBlock Text="{Binding NotesCountDisplay}"
													   FontWeight="SemiBold"
													   HorizontalAlignment="Center"/>
										</StackPanel>
										<StackPanel ToolTip="Percentage of black keys (sharps/flats)">
											<TextBlock Text="Black Keys"
													   FontSize="10"
													   Opacity="0.6"
													   HorizontalAlignment="Center"/>
											<TextBlock Text="{Binding BlackKeyRatioDisplay}"
													   FontWeight="SemiBold"
													   HorizontalAlignment="Center"/>
										</StackPanel>
										<StackPanel ToolTip="Average note duration">
											<TextBlock Text="Avg Duration"
													   FontSize="10"
													   Opacity="0.6"
													   HorizontalAlignment="Center"/>
											<TextBlock Text="{Binding AverageDurationDisplay}"
													   FontWeight="SemiBold"
													   HorizontalAlignment="Center"/>
										</StackPanel>
										<StackPanel ToolTip="Ratio of frequently repeating notes">
											<TextBlock Text="Frequent"
													   FontSize="10"
													   Opacity="0.6"
													   HorizontalAlignment="Center"/>
											<TextBlock Text="{Binding FrequentNotesRatioDisplay}"
													   FontWeight="SemiBold"
													   HorizontalAlignment="Center"/>
										</StackPanel>
									</modern:SimpleStackPanel>
								</Grid>
							</Border>
						</Grid>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>
		</ScrollViewer>
	</Grid>
</UserControl>
